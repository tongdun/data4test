## 数据生成+性能测试方案设计

### 数据生成

#### 目标

- 通过程序自动生成API接口需要的数据进行单接口的模糊测试
- 通过程序自动生成海量数据进行单接口的并发测试
- 以单接口为主体，进行指定参数的多值定义，完成简单场景数据的遍历测试
- 以单接口为原子，进行接口的流程组合，完成复杂场景测试



#### 实现

- 单接口

  - 模糊测试（Fuzzing Test）: 使用随机数据测试API，完成手工测试无法遍历的数据场景

  - 性能测试:   并发测试，数据量：1k / 10k / 10w / ……

- 多接口

  - 场景测试：多接口组合，手动维护接口关系
  - 并发测试：不同接口按权重/比例发起测试



#### 方案

##### 前期数据准备

- 被测系统 api swagger文档



##### 数据生成

- 接口用例生成
  - 手动：获取api swagger文档，导入时自动生成（数据形式）
  - 自动：提供api swagger url, 自动获取api swagger文档，并自动生成 
  - 用例ID： 根据接口特征自动生成
    - Restful API: `post_/path, put_/path, delete_path, get_/path`
    - Dubbo:  ……
  - 支持手工录入接口用例数据，CRUD

- 单接口测试数据生成

  - 参数类型：根据接口参数类型（int/string/bool），自动生成对应类型的数据供接口使用
    - int: `-1, 0, 65536, 256` 边界值
    - string: `空字符串，长度为8，256， 512，1024` 边界值
    - bool : `true, false` 枚举值
  - 随机数据： 根据接口生成随机数据供接口使用
    - 包括边界值，异常值
    - 超长，超短
    - 正向测试，反向测试
    - ……

  - 自定义数据：

    - 指定参数枚举值录入
    - 整个接口的运行数据录入

    

- 多接口测试数据生成

  - 从单接口中选择数据进行测试
    - 全部正常
    - 中间接口数据异常
    - 最后接口数据异常
    - 首接口数据异常
    - ……
  - 人工介入还是程序按一定规则使用数据，可以摸索
  - 自定义数据：根据需要，为指定场景提供部分接口的数据



##### 数据维护

- API关联关系维护
  - 接口链路：`post_/path -> get_/path -> put_/path -> get_/path -> delete_/path -> get_/path ` 
  - 接口关联：`post_/path `所有请求参数和返回唯一ID提供给 `get_/path`做数据校验;   返回唯一ID提供给`put_/path`做修改， 提供给`delete_/path`做数据删除……（唯一标识可以人工指定，最好是要求开发在接口层面返回提供，减少人工介入）
- API参数依赖关系维护
  - 前置接口需要提供参数给后置接口，参数名称不一样是，需要做转换，转成后置接口需要的数据（可以要求开发在不同系统中，对同一信息使用同一命令，减少数据转换工作）





### 性能测试

##### 目标

- 获取系统在特定环境下，支持的并发数据，指导使用者进行环境规划，对系统承受能务的预知



##### 实现

- 环境配置信息获取：
  - 手动录入
  - 自动获取

- 单接口的高并发测试
- 多接口按权重或比例进行并发测试



##### 测试类型

- 基准测试： 基线数据的获取和制定（先重点）
- 负载测试：分级加压，把环境各项资源消耗到一定比例，看系统的运行速度和稳定性
- 压力测试：加压到环境极限，把环境各项资源耗到99%以上，看系统的运行速度和稳定性
- 稳定测试：系统在多少的数据量下，系统运行速度和稳定性均有保障
- 并发测试：1k / 10k / 10w / ……



#### 方案

##### 前期数据准备

- 被测试环境信息

  - 主机：IP / http / https

  - 鉴权：用户 / 密码 / Token


- 环境信息采集
  - CPU
  - Mem
  - Disk
  - Network
  
- 接口并发请求数据
  - 响应时间
  - 并发数
  - TPS
  - 错误率
  




